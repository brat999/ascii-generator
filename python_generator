const ASCII_CHARS = ["‹", "!", "#", "Ç", "-", "_", "#", "?", "“", "≠", " "];

// Resize image according to a new width
function resizeImage(image, newWidth = 100) {
    const width = image.width;
    const height = image.height;
    const ratio = height / width;
    const newHeight = Math.round(newWidth * ratio);
    const canvas = document.createElement('canvas');
    const context = canvas.getContext('2d');
    canvas.width = newWidth;
    canvas.height = newHeight;
    context.drawImage(image, 0, 0, newWidth, newHeight);
    return canvas;
}

// Convert each pixel to grayscale
function grayify(imageData) {
    const data = imageData.data;
    for (let i = 0; i < data.length; i += 4) {
        const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
        data[i] = data[i + 1] = data[i + 2] = avg; // Red, Green, Blue channels set to average
    }
    return imageData;
}

// Convert pixels to ASCII characters
function pixelsToAscii(imageData) {
    const pixels = imageData.data;
    let ascii = '';
    for (let i = 0; i < pixels.length; i += 4) {
        const pixel = pixels[i]; // Only use the red channel since it's grayscale now
        ascii += ASCII_CHARS[Math.floor(pixel / 25)];
    }
    return ascii;
}

// Generate ASCII from uploaded image
function generateAscii() {
    const fileInput = document.getElementById('imageInput');
    const file = fileInput.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(event) {
        const img = new Image();
        img.onload = function() {
            const canvas = resizeImage(img, 100);
            const context = canvas.getContext('2d');
            let imageData = context.getImageData(0, 0, canvas.width, canvas.height);
            imageData = grayify(imageData);
            const asciiArt = pixelsToAscii(imageData);

            // Format ASCII Art and display it
            const newWidth = 100;
            let formattedAscii = '';
            for (let i = 0; i < asciiArt.length; i += newWidth) {
                formattedAscii += asciiArt.slice(i, i + newWidth) + '\n';
            }

            // Display ASCII art on the page
            document.getElementById('outputArea').textContent = formattedAscii;
        };
        img.src = event.target.result;
    };
    reader.readAsDataURL(file);
}
